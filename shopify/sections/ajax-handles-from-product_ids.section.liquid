{%- comment -%}
  ------------------------------------------------------------------------------------
   USED INAJAX
  ------------------------------------------------------------------------------------
{%- endcomment -%}

{%- liquid
  assign page_url = content_for_header | split: '"pageurl":"' | last | split: '"' | first
  assign page_url = page_url | replace: '\/', '/' | replace: '%20', ' '
  assign page_url = page_url | split: '?'
  assign page_url = page_url[1]
  assign page_url = page_url | split: '\u0026'

  for param in page_url
    assign pair = param | split: '='
    if pair[0] == 'product_ids'
      assign product_ids = pair[1]
    endif
  endfor

  assign ids = product_ids | split: ','

  assign items = '{'
  assign count = ids.size

  paginate collections.all.products by 10000
    for id in ids
      assign numId = id | plus: 0
      assign filter = collections.all.products | where: 'id', numId | first

      if count != ids.size
        assign items = items | append: ','
      endif
      assign count = count | minus: 1

      assign line = '"' | append: filter.id | append: '": "' | append: filter.handle | append: '"'
      assign items = items | append: line
      if count == 0
        break
      endif
    endfor
    assign items = items | append: '}'
  endpaginate
%}

{ "items" : {{ items }} }
