{%- assign blog = section.settings.blog -%}

{% capture section_style %}
  --section-articles-count: {% if blog == blank or blog.articles_count == 0 %}{{ section.settings.articles_count }}{% else %}{{ blog.articles_count | at_most: section.settings.articles_count }}{% endif %};
{% endcapture %}

{% capture content %}
  {%- if section.settings.articles_count == 4
  and blog == blank
  or blog.articles_count >= 4
  or blog.articles_count == 0
  -%}
    {%- assign use_featured_layout = true -%}
  {%- else -%}
    {%- assign use_featured_layout = false -%}
  {%- endif -%}

  {%- capture section_content -%}
    <article-list {% if settings.stagger_blog_posts_apparition %}stagger-apparition{% endif %} class="article-list article-list--section {% if use_featured_layout %}article-list--has-four{% endif %} {% unless section.settings.stack_mobile -%}article-list--scrollable{% else %}article-list--stacked{% endunless %} {% if use_featured_layout %}hidden-lap-and-up{% endif %}">
      {%- for article in blog.articles limit: section.settings.articles_count -%}
        {%- render 'article-item', article: article, heading_size: 'h4' -%}
      {%- else -%}
        {%- for i in (1..section.settings.articles_count) -%}
          <div {% if settings.stagger_blog_posts_apparition %}reveal{% endif %} class="article-item">
            <div class="article-item__image-container">
              <div class="placeholder-image" style="padding-bottom: 75%">
                {{ 'image' | placeholder_svg_tag }}
              </div>
            </div>

            <div class="article-item__content">
              {%- if section.settings.show_category -%}
                <p class="article-item__category heading heading--xsmall">{{ 'general.onboarding.blog_post_category' | t }}</p>
              {%- endif -%}

              <h3 class="article-item__title heading h4">{{ 'general.onboarding.blog_post_title' | t }}</h3>
            </div>
          </div>
        {%- endfor -%}
      {%- endfor -%}
    </article-list>

    {%- comment -%}
    If we use the featured layout (so 4 articles) on desktop the layout is vastly different. We also have different font sizes
    for the various heading. Of course we could change that dynamically in JavaScript, but this may cause CLS, so I prefer to
    duplicate the content directly.
    {%- endcomment -%}

    {%- if use_featured_layout -%}
      <article-list {% if settings.stagger_blog_posts_apparition %}stagger-apparition{% endif %} class="article-list article-list--section article-list--collage hidden-pocket">
        {%- if blog != blank and blog.articles_count > 0 -%}
          {%- render 'article-item', article: blog.articles.first, use_featured_layout: true, is_first: true, heading_size: 'h3' -%}

          <div class="article-list__secondary-list">
            {%- for article in blog.articles offset: 1 limit: 3 -%}
              {%- render 'article-item', article: article, use_featured_layout: true, is_first: false, heading_size: 'h5' -%}
            {%- endfor -%}
          </div>
        {%- else -%}
          <div {% if settings.stagger_blog_posts_apparition %}reveal{% endif %} class="article-item {% if use_featured_layout %}article-item--featured{% endif %}">
            <div class="article-item__image-container">
              <div class="placeholder-image" style="padding-bottom: 75%">
                {{ 'image' | placeholder_svg_tag }}
              </div>
            </div>

            <div class="article-item__content">
              {%- if section.settings.show_category -%}
                <p class="article-item__category heading heading--xsmall">{{ 'general.onboarding.blog_post_category' | t }}</p>
              {%- endif -%}

              <h3 class="article-item__title heading h3">{{ 'general.onboarding.blog_post_title' | t }}</h3>
            </div>
          </div>

          <div class="article-list__secondary-list">
            {%- for i in (1..3) -%}
              <div {% if settings.stagger_blog_posts_apparition %}reveal{% endif %} class="article-item {% if use_featured_layout %}{% if is_first %}article-item--featured{% else %}article-item--horizontal{% endif %}{% endif %}">
                <div class="article-item__image-container">
                  <div class="placeholder-image" style="padding-bottom: 75%">
                    {{ 'image' | placeholder_svg_tag }}
                  </div>
                </div>

                <div class="article-item__content">
                  {%- if section.settings.show_category -%}
                    <p class="article-item__category heading heading--xsmall">{{ 'general.onboarding.blog_post_category' | t }}</p>
                  {%- endif -%}

                  <h3 class="article-item__title heading h6">{{ 'general.onboarding.blog_post_title' | t }}</h3>
                </div>
              </div>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </article-list>
    {%- endif -%}
  {%- endcapture -%}

  {%- if section.settings.stack_mobile -%}
    {{- section_content -}}
  {%- else -%}
    <div class="scroller">
      <div class="scroller__inner">
        {{- section_content -}}
      </div>
    </div>
  {%- endif -%}
{% endcapture %}

{% render 'section-layout', content: content, extra_section_style: section_style %}
