{%- assign acceptable_recommendations_count = 0 -%}

{%- for product in recommendations.products -%}
  {% if product.type == 'static' %}
    {% continue %}
  {% endif %}
  {%- assign matching_product = cart.items | where: 'product_id', product.id | first -%}

  {%- if matching_product == blank -%}
    {%- assign acceptable_recommendations_count = acceptable_recommendations_count | plus: 1 -%}
  {%- endif -%}
{%- endfor -%}

{%- if recommendations.performed -%}
  {%- if acceptable_recommendations_count > 0 -%}
    <div recommendations-target class="mini-cart__recommendations-inner">
      {%- if settings.recommendations_title != blank -%}
        <p class="mini-cart__recommendations-heading heading heading--small hidden-pocket">
          {{ settings.recommendations_title | escape }}
        </p>
        <p class="mini-cart__recommendations-heading heading heading--xsmall text--subdued hidden-lap-and-up">
          {{ settings.recommendations_title | escape }}
        </p>
      {%- endif -%}

      <div class="scroller">
        <div class="scroller__inner">
          <div class="mini-cart__recommendations-list">
            {%- assign shown_products_count = 0 -%}

            {%- for product in recommendations.products -%}
              {% if product.type == 'static' %}
                {% continue %}
              {% endif %}
              {%- if shown_products_count >= 6 -%}
                {%- break -%}
              {%- endif -%}

              {%- assign matching_product = cart.items | where: 'product_id', product.id -%}

              {%- if matching_product.size == 0 -%}
                {%- assign shown_products_count = shown_products_count | plus: 1 -%}
                {%- render 'product-item',
                  product: product,
                  reduced_content: true,
                  reduced_font_size: true,
                  hide_secondary_image: true,
                  sizes_attribute: '(max-width: 740px) 65px, 92px',
                  position: forloop.index,
                  list: 'cart:recommendations',
                  enable_media_in_slider: settings.enable_media_in_slider_reduced
                -%}
              {%- endif -%}
            {%- endfor -%}
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div recommendations-target class="mini-cart__recommendations-inner"></div>
  {%- endif -%}
{% endif %}
