<style>
  #shopify-section-{{ section.id }} {

  {%- if section.settings.text_color == 'rgba(0,0,0,0)' -%}
  {%- assign heading_color = settings.heading_color -%}
  {%- assign text_color = settings.text_color -%}
  {%- else -%}
  {%- assign heading_color = section.settings.text_color -%}
  {%- assign text_color = section.settings.text_color -%}
  {%- endif -%}

  {%- if section.settings.button_background == 'rgba(0,0,0,0)' -%}
  {%- assign button_background = settings.primary_button_background -%}
  {%- else -%}
  {%- assign button_background = section.settings.button_background -%}
  {%- endif -%}

  {%- if section.settings.button_text_color == 'rgba(0,0,0,0)' -%}
  {%- assign button_text_color = settings.primary_button_text_color -%}
  {%- else -%}
  {%- assign button_text_color = section.settings.button_text_color -%}
  {%- endif -%}

  {%- if section.settings.required_field_color == 'rgba(0,0,0,0)' -%}
  {%- assign required_field_color = settings.text_color -%}
  {%- else -%}
  {%- assign required_field_color = section.settings.required_field_color -%}
  {%- endif -%}

    --heading-color: {{ heading_color.red }}, {{ heading_color.green }}, {{ heading_color.blue }};
    --text-color: {{ text_color.red }}, {{ text_color.green }}, {{ text_color.blue }};
    --primary-button-background: {{ button_background.red }}, {{ button_background.green }}, {{ button_background.blue }};
    --primary-button-text-color: {{ button_text_color.red }}, {{ button_text_color.green }}, {{ button_text_color.blue }};

    --required-field-color : {{ required_field_color.red }}, {{ required_field_color.green }}, {{ required_field_color.blue }}
  }

  #shopify-section-{{ section.id }} .account__block-list {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  @media screen and (min-width: 1000px) {
    #shopify-section-{{ section.id }} .account__block-list {
      flex-direction: row;
    }

  {% if section.settings.login_form_position == "right" %}
    #shopify-section-{{ section.id }} .account__block-list {
      flex-direction: row-reverse;
    }
  {% endif %}

  }

  {% if section.settings.register_toggle %}
  #shopify-section-{{ section.id }} .account__block-list {
    justify-content: space-between;
  }
  {% endif %}

  #shopify-section-{{ section.id }} .account__block-item {
    flex: 0 0 50%;
  }

  {% if section.settings.social_login_position == 'below_login_form' %}
  .oxi-social-login {
    display: inline-block;
    margin-top: 15px;
    width: 100%;
  }
  #login-form-panel .form__submit {
    margin-top: 15px;
  }

  {% endif %}
</style>

{% assign login_title_text_transform = section.settings.login_title_text_transform %}
{% assign register_title_text_transform = section.settings.register_title_text_transform %}

{% comment %}
  Captcha bindings

  Note:
  if we pass nil value to the 'data-shopify-captcha' form attribute
  then the attribute is not rendered in the DOM.
{% endcomment %}
{% assign force_register_form_captcha = null %}
{% assign force_login_form_captcha = null %}
{% if section.settings.force_register_form_captcha %}
  {% assign force_register_form_captcha = 'true' %}
{% endif %}
{% if section.settings.force_login_form_captcha %}
  {% assign force_login_form_captcha = 'true' %}
{% endif %}

{%- capture status -%}
  {%- form 'recover_customer_password' -%}
    {%- if form.posted_successfully? -%}
      {%- assign is_recover_posted_successfully = true -%}
    {%- else -%}
      {%- assign is_recover_posted_successfully = false -%}
    {%- endif -%}
  {%- endform -%}
{%- endcapture -%}
{% render 'vite-tag' with '@modules/main-pages/main-customers-login' %}
<section class="oz-section">
  <perishable-message
    name="login_message"
  >
    <template>
      <div class="container">
        <div class="form__banner banner banner--warning">
          <span class="banner__ribbon">{% render 'icon' with 'form-error' %}</span>
          <p class="banner__content">#message#</p>
        </div>
      </div>
    </template>
  </perishable-message>

  <div class="oz-section__inner container">
    <div id="login-form-container">
      <div class="page-content page-content--fluid">
        {% if section.settings.mobile_tabs_toggle == true %}
          <div class="customer-tabs__container">
            <tabs-nav
              id="search-tabs-nav"
              class="tabs-nav tabs-nav--center tabs-nav--no-border tabs-nav--edge2edge hidden-tablet-and-up"
            >
              <scrollable-content class="tabs-nav__scroller hide-scrollbar">
                <div class="tabs-nav__scroller-inner">
                  <div class="tabs-nav__item-list">
                    <button
                      class="tabs-nav__item heading heading--small"
                      data-type="{{ first_matching_type | escape }}"
                      aria-expanded="true"
                      aria-controls="login-form-panel"
                    >
                      {{ 'customer.login.title' | t }}
                    </button>
                    <button
                      class="tabs-nav__item heading heading--small"
                      data-type="{{ first_matching_type | escape }}"
                      aria-expanded="true"
                      aria-controls="register-form-panel"
                    >
                      {{ 'customer.register.title' | t }}
                    </button>
                  </div>
                </div>
              </scrollable-content>
            </tabs-nav>
          </div>
        {% endif %}

        <div class="account__block-list">
          <div
            id="login-form-panel"
            class="account__block-item"
            {{ section.shopify_attributes }}
          >
            {%- comment -%}
              --------------------------------------------------------------------------------------------------------------------
              CUSTOMER LOGIN FORM
              --------------------------------------------------------------------------------------------------------------------
            {%- endcomment -%}

            <div class="page-header">
              <div class="page-header__text-wrapper text-container">
                <span class="heading {{ section.settings.heading_size }}{% if login_title_text_transform != blank %} text-transform--{{ login_title_text_transform }}{% endif %}">
                  {{- section.settings.connexion_title -}}
                </span>
                <p>{{ section.settings.connexion_subtitle }}</p>
                {% if settings.account_login_note != blank %}
                  <p class="account__login-note">{{ settings.account_login_note }}</p>
                {% endif %}
              </div>
            </div>

            {% if section.settings.social_login_position == 'above_login_form' %}
              <social-login class="oxi-social-login"></social-login>
            {% endif %}

            {%- form 'customer_login',
              name: 'login',
              class: 'form',
              is: 'cancellable-form',
              data-shopify-captcha: force_login_form_captcha
            -%}
              {% unless template.name == 'register' %}
                {%- if form.errors -%}
                  <banner-error
                    error-list="{{ form.errors |  join: "," }}"
                    class="banner banner--error form__banner"
                    id="login-form-error"
                  >
                    <span class="banner__ribbon">{% render 'icon' with 'form-error' %}</span>
                    <p class="banner__content">{{ form.errors.messages.form }}</p>
                  </banner-error>
                {%- endif -%}
              {% endunless %}

              <div class="input">
                <input
                  type="email"
                  id="customer-login[email]"
                  autocomplete="email"
                  class="input__field"
                  name="customer[email]"
                  required="required"
                  {% if form.errors %}
                    aria-invalid="true" aria-describedby="login-form-error"
                  {% endif %}
                >
                <label for="customer-login[email]" class="input__label">{{ 'customer.login.email' | t }}</label>
              </div>

              {%- render 'password-control',
                name: 'customer[password]',
                id: 'customer-login[password]',
                forgot_password_link: true,
                autocomplete: 'current-password',
                label_text_key: 'customer.login.password'
              -%}

              <ajax-registering
                form="customer_login"
                page="login"
              ></ajax-registering>

              {% if section.settings.social_login_position == 'below_login_form' %}
                <social-login class="oxi-social-login"></social-login>
              {% endif %}

              <button
                type="submit"
                is="loader-button"
                class="form__submit button button--{{ section.settings.link_style }} button--full"
              >
                {{ 'customer.login.submit' | t }}
              </button>

              {% if section.settings.register_toggle != true %}
                <span class="form__secondary-action text--subdued">
                  {{- 'customer.login.new_customer' | t -}}
                  <a href="{{ routes.account_register_url }}" class="link">
                    {{- 'customer.login.create_account' | t -}}
                  </a>
                </span>
              {% endif %}
            {%- endform -%}
          </div>

          {%- comment -%}
            --------------------------------------------------------------------------------------------------------------------
            CUSTOMER REGISTER FORM
            --------------------------------------------------------------------------------------------------------------------
          {%- endcomment -%}
          {% if section.settings.register_toggle %}
            <div
              id="register-form-panel"
              class="account__block-item"
            >
              {% render 'register', force_register_form_captcha: force_register_form_captcha %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    {%- comment -%}
      --------------------------------------------------------------------------------------------------------------------
      CUSTOMER RECOVERY FORM
      --------------------------------------------------------------------------------------------------------------------
    {%- endcomment -%}

    <div id="recover-form-container" style="display: none">
      <div class="page-header">
        <div class="page-header__text-wrapper text-container">
          <span class="heading {{ section.settings.heading_size }}">
            {{- 'customer.recover_password.title' | t -}}
          </span>

          {%- unless is_recover_posted_successfully -%}
            <p>{{ 'customer.recover_password.instructions' | t }}</p>
          {%- endunless -%}
          {% if settings.account_login_note != blank %}
            <p class="account__login-note">
              {{ settings.account_login_note | replace: '<a', '<a data-action="switch-login-form"' }}
            </p>
          {% endif %}
        </div>
      </div>

      <div class="page-content page-content--small ">
        {%- form 'recover_customer_password', name: 'recover', class: 'form' -%}
          {%- if form.errors -%}
            <div class="banner banner--error form__banner" id="recovery-form-error">
              <span class="banner__ribbon">{% render 'icon' with 'form-error' %}</span>
              <p class="banner__content">{{ form.errors.messages.form }}</p>
            </div>
          {%- endif -%}

          {%- if form.posted_successfully? -%}
            <div class="banner banner--success form__banner">
              <span class="banner__ribbon">{% render 'icon' with 'form-success' %}</span>
              <p class="banner__content">{{ 'customer.recover_password.success' | t }}</p>
            </div>
          {%- else -%}
            <div class="input">
              <input
                type="email"
                id="customer[recover_email]"
                class="input__field"
                name="email"
                required="required"
                {% if form.errors %}
                  aria-invalid="true" aria-describedby="recovery-form-error"
                {% endif %}
              >
              <label for="customer[recover_email]" class="input__label">
                {{- 'customer.recover_password.email' | t -}}
              </label>
            </div>

            <button type="submit" is="loader-button" class="form__submit button button--primary button--full">
              {{ 'customer.recover_password.submit' | t }}
            </button>
          {%- endif -%}

          {%- unless form.posted_successfully? -%}
            <span class="form__secondary-action text--subdued">
              {{- 'customer.recover_password.remember_password' | t -}}
              <button type="button" class="link" data-action="switch-login-form">
                {{ 'customer.recover_password.back_to_login' | t }}
              </button>
            </span>
          {%- endunless -%}
        {%- endform -%}
      </div>
    </div>
  </div>

  <script>
    // The script for this is very minimal so we just embed it here
    window.addEventListener('DOMContentLoaded', () => {
      const loginFormElement = document.getElementById('login-form-container'),
              recoverFormElement = document.getElementById('recover-form-container');

      const switchForms = () => {
        loginFormElement.style.display = (window.getComputedStyle(loginFormElement).display) === 'block' ? 'none' : 'block';
        recoverFormElement.style.display = (window.getComputedStyle(recoverFormElement).display) === 'block' ? 'none' : 'block';
      }

      {% if is_recover_posted_successfully %}
      switchForms();
      {% else %}
      if (window.location.hash === '#recover') {
        switchForms();
      }
      {% endif %}

      Array.from(document.querySelectorAll('[data-action="switch-login-form"]')).forEach((button) => {
        button.addEventListener('click', () => switchForms());
      });

      {% if section.settings.mobile_tabs_toggle == true %}
      if (window.matchMedia("(max-width: 741px)").matches) {
        document.getElementById("register-form-panel").setAttribute('hidden','')
      }
      {% endif %}

    });
  </script>
</section>
